pattern: "(?P<level>\\w+)\\s+(?P<message>.*)"

# Test variable substitution edge cases

inject:
  - key: SIMPLE_VAR
    value: "${LINE}"

  - key: MULTIPLE_VARS
    value: "Level: ${LEVEL}, Message: ${MESSAGE}"

  - key: NESTED_VARS
    value: "${${LEVEL}_PREFIX}_${MESSAGE}"

  - key: UNDEFINED_VAR
    value: "This ${UNDEFINED_VARIABLE} does not exist"

  - key: ESCAPED_VAR
    value: "\\${NOT_A_VARIABLE}"

  # Commented out - causes parse error as expected
  # - key: MALFORMED_VAR1
  #   value: "Start ${UNCLOSED end"  # Missing closing brace

  - key: MALFORMED_VAR2
    value: "$NO_BRACES"

  - key: EMPTY_VAR_NAME
    value: "${}"

  - key: NUMERIC_VAR
    value: "${123}"

  - key: SPECIAL_VAR_NAME
    value: "${VAR-WITH-DASHES}"

  - key: WHITESPACE_VAR
    value: "${ PADDED }"

rewrite:
  - key: VAR_IN_MATCH
    match: "${LEVEL}"  # Variable in match pattern
    value: "Matched level"

  - key: RECURSIVE_VAR
    value: "${VAR_IN_MATCH}"
    inject: yes

  - key: CONDITIONAL_VAR
    match: "ERROR"
    value: "Error: ${MESSAGE}"

  - key: DEFAULT_VALUE
    value: "${MISSING:-default value}"
    inject: yes

  - key: CHAINED_VARS
    value: "${A}${B}${C}${D}${E}"
    inject: yes

rename:
  - old_key: "${LEVEL}_KEY"  # Variable in key name
    new_key: "LEVEL_KEY"

  - old_key: "OLD_${UNDEFINED}"
    new_key: "NEW_KEY"

filter:
  include: ".*"  # Include all keys to actually test variable substitution
  exclude: "^$"

unmatched:
  key: "UNMATCHED_${LEVEL}"
  inject:
    - key: "ERROR_${LEVEL}"
      value: "Failed to parse ${LINE}"
