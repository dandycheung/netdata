# Test variable substitution logic
pattern: "(?P<user>\\w+)\\s+(?P<action>\\w+)\\s+(?P<resource>\\S+)"

inject:
  - key: BASE_MSG
    value: "User ${USER} performed ${ACTION}"

  - key: FULL_MSG
    value: "${BASE_MSG} on ${RESOURCE}"

  - key: UNDEFINED_VAR
    value: "${NONEXISTENT} should be empty"

  - key: CIRCULAR_TEST
    value: "${CIRCULAR_TEST}"  # Self-reference

  - key: LINE_VAR
    value: "Original: ${LINE}"

rewrite:
  # Test variable in match pattern
  - key: ACTION
    match: "delete"
    value: "DANGEROUS_${ACTION}"

  # Test using rewritten value
  - key: ACTION_LEVEL
    value: "${ACTION}"
    inject: yes

  # Test multiple variables
  - key: SUMMARY
    value: "${USER}:${ACTION}:${RESOURCE}"
    inject: yes